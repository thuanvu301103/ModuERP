{% load static %}
{% load sass_tags %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Inventory{% endblock %}</title>
    <link href="{% sass_src 'scss/custom.scss' %}" rel="stylesheet" type="text/css">
    <!-- htmx -->
    <script src="https://unpkg.com/htmx.org@1.9.9"></script>
    <!-- alpine.js -->
    <script src="//unpkg.com/alpinejs" defer></script>
</head>
<body class="d-flex flex-column min-vh-100 bg-black text-white">

    <!-- Header -->
    <div class="d-flex flex-column bg-dark p-3 gap-2 sticky-top">
        <!-- Navigation bar -->
        <nav class="d-flex flex-row align-items-center gap-2">
            <!-- Icon -->
            <img src="{% static 'icons/inventory.logo.svg' %}" alt="inventory icon" height="20">
            <div name="title" class="fs-5 fw-bold text-white">Inventory</div>
            <!-- Buttons links -->
            <a href="{% url 'inventory:product_list' %}" class="btn btn-dark btn-sm">Products</a>
        </nav>
        <!-- Toolbar -->
        {% block toolbar %}{% endblock %}
        <!-- Table Header -->
        {% block tableHeader %}{% endblock %}
    </div>
    
    <!-- Content -->
    <div class="flex-grow-1 d-flex" id="content">
        {% block content %}{% endblock %}
    </div>

    <!-- Model -->
    {% block model %} {%endblock%}

    

    <script>
        const filterbtn = document.getElementById("filter-btn");
        const filterContainer = document.getElementById("filter-container");

        filterbtn.addEventListener("click", () => {
            if (filterbtn.classList.contains("active")) {
            // ðŸ‘‰ NÃºt Ä‘ang á»Ÿ tráº¡ng thÃ¡i ON
            let domain = [];

            filterContainer.querySelectorAll(".filter-row").forEach(row => {
                let field = row.querySelector('[name="field"]').value;
                let operator = row.querySelector('[name="operator"]').value;
                let value = row.querySelector('[name="value"]').value;

                if (value) {
                    domain.push([field, operator, isNaN(value) ? value : Number(value)]);
                    }
                });

                // Encode domain to JSON string
                let params = new URLSearchParams();
                params.append("domain", JSON.stringify(domain));
                // Call htmx load product list
                htmx.ajax('GET', `../products?${params.toString()}`, "#product-list-view");
            } else {
                htmx.ajax('GET', `../products`, "#product-list-view");
            }
        });
    </script>
</body>
</html>
